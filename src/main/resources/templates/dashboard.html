<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>My Dashboard - Hostel Management</title>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    *{box-sizing:border-box;}
    body{font-family:Arial,sans-serif;margin:0;background:#f0f2f5;display:flex;flex-direction:column;min-height:100vh;}
    main{flex:1;}
    .page-header{background:white;padding:20px 30px;border-bottom:1px solid #eee;display:flex;align-items:center;gap:14px;}
    .page-header .avatar{width:46px;height:46px;background:#3498db;border-radius:50%;color:white;display:flex;align-items:center;justify-content:center;font-size:20px;}
    .page-header h2{margin:0;font-size:20px;color:#1a252f;}
    .page-header p{margin:2px 0 0;font-size:13px;color:#888;}

    /* ====== HORIZONTAL TAB BAR ====== */
    .tab-bar{
      display:flex; overflow-x:auto; background:white;
      border-bottom:2px solid #eee; padding:0 20px;
      white-space:nowrap; gap:0;
    }
    .tab-bar::-webkit-scrollbar{height:4px;}
    .tab-bar::-webkit-scrollbar-thumb{background:#ddd;border-radius:4px;}
    .tab-bar a{
      display:inline-block; padding:14px 20px;
      text-decoration:none; color:#888; font-size:14px; font-weight:bold;
      border-bottom:3px solid transparent; transition:all 0.2s;
    }
    .tab-bar a:hover{color:#3498db;}
    /* Make the first tab appear active by default using :target or just style */
    .tab-bar a.tab-active{color:#3498db;border-bottom:3px solid #3498db;}
    /* Greyed out locked tabs */
    .tab-bar a.tab-locked{color:#ccc;cursor:default;pointer-events:none;}
    .tab-bar a.tab-locked:hover{color:#ccc;}

    /* ====== TAB CONTENT SECTIONS ====== */
    .tab-content{max-width:800px;margin:25px auto;padding:0 15px;}
    .section-panel{display:none;}           /* all hidden by default */
    .section-panel:target{display:block;}   /* show when URL has #id */
    /* Always show status panel as default (first section) */
    .section-panel.default-show{display:block;}

    .card{background:white;border-radius:12px;padding:26px;margin-bottom:20px;box-shadow:0 2px 10px rgba(0,0,0,0.08);}
    .card h3{margin:0 0 16px;color:#1a252f;font-size:16px;border-bottom:1px solid #f0f2f5;padding-bottom:10px;}

    /* Status steps */
    .steps{display:flex;gap:0;margin-bottom:10px;}
    .step{flex:1;text-align:center;padding:12px 4px;font-size:12px;font-weight:bold;}
    .step .step-icon{font-size:24px;display:block;margin-bottom:4px;}
    .step-done   {color:#27ae60;}
    .step-active {color:#3498db;}
    .step-pending{color:#f39c12;}
    .step-locked {color:#ccc;}
    .step-rejected{color:#e74c3c;}
    .step-connector{width:20px;align-self:center;color:#ddd;font-size:18px;text-align:center;}

    /* Badge */
    .badge{display:inline-block;padding:5px 14px;border-radius:20px;font-size:13px;font-weight:bold;}
    .badge-pending {background:#fff3cd;color:#856404;}
    .badge-approved{background:#d4edda;color:#155724;}
    .badge-rejected{background:#f8d7da;color:#721c24;}

    /* Profile grid */
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px 24px;}
    .info-grid .item label{display:block;font-size:11px;color:#888;text-transform:uppercase;letter-spacing:0.5px;}
    .info-grid .item span{font-size:14px;color:#333;font-weight:bold;}

    /* Locked feature box */
    .locked-box{background:#f8f9fa;border:2px dashed #ddd;border-radius:10px;padding:30px;text-align:center;color:#bbb;}
    .locked-box .lock-icon{font-size:36px;margin-bottom:8px;}
    .locked-box p{margin:0;font-size:14px;}

    /* Action buttons */
    .btn-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px;}
    .action-btn{display:inline-block;padding:11px 22px;border-radius:8px;text-decoration:none;color:white;font-size:14px;font-weight:bold;}
    .btn-green{background:#27ae60;}
    .btn-blue {background:#3498db;}
    .btn-red  {background:#e74c3c;}
    .action-btn:hover{opacity:0.85;}

    .alert{padding:11px 16px;border-radius:8px;margin-bottom:16px;font-size:14px;}
    .alert-success{background:#d4edda;color:#155724;}
  </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<main>

  <!-- Page Header -->
  <div class="page-header">
    <div class="avatar">ğŸ‘¤</div>
    <div>
      <h2 th:text="${session.loggedUser.name}">Student Name</h2>
      <p th:text="${session.loggedUser.email}">email</p>
    </div>
  </div>

  <!-- ====== HORIZONTAL TAB BAR ====== -->
  <!--
    Pure CSS trick: clicking a tab changes URL hash (#section-id)
    CSS :target selector shows that section
    The "Status" tab/section is shown by default (.default-show)
    Locked tabs (greyed) are not clickable
  -->
  <div class="tab-bar">
    <a href="#tab-status" class="tab-active">ğŸ“Š Admission Status</a>
    <a href="#tab-profile" th:if="${profile != null}">ğŸ‘¤ My Profile</a>
    <!-- Rent tab: active link if approved, locked if not -->
    <a href="#tab-rent"
       th:if="${profile != null and profile.status.name() == 'APPROVED'}">ğŸ’° Rent Payment</a>
    <a class="tab-locked"
       th:if="${profile == null or profile.status.name() != 'APPROVED'}">ğŸ’° Rent Payment</a>
    <!-- Query tab: active link if approved, locked if not -->
    <a href="#tab-query"
       th:if="${profile != null and profile.status.name() == 'APPROVED'}">ğŸ“© Query / Support</a>
    <a class="tab-locked"
       th:if="${profile == null or profile.status.name() != 'APPROVED'}">ğŸ“© Query / Support</a>
  </div>

  <div class="tab-content">

    <!-- ====== TAB 1: STATUS (default visible) ====== -->
    <div id="tab-status" class="section-panel default-show">

      <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

      <div class="card">
        <h3>ğŸ“Š Your Admission Progress</h3>

        <!-- Step progress indicator -->
        <!-- NO PROFILE YET -->
        <div th:if="${profile == null}">
          <div class="steps">
            <div class="step step-done"><span class="step-icon">âœ…</span>Registered</div>
            <div class="step-connector">â€º</div>
            <div class="step step-active"><span class="step-icon">ğŸ“‹</span>Fill Form</div>
            <div class="step-connector">â€º</div>
            <div class="step step-locked"><span class="step-icon">â³</span>Pending</div>
            <div class="step-connector">â€º</div>
            <div class="step step-locked"><span class="step-icon">ğŸ </span>Hostel</div>
          </div>
          <p style="color:#666;font-size:14px;">You haven't submitted your admission form yet.</p>
          <div class="btn-row">
            <a href="/admission" class="action-btn btn-blue">ğŸ“‹ Fill Admission Form</a>
          </div>
        </div>

        <!-- PENDING -->
        <div th:if="${profile != null and profile.status.name() == 'PENDING'}">
          <div class="steps">
            <div class="step step-done"><span class="step-icon">âœ…</span>Registered</div>
            <div class="step-connector">â€º</div>
            <div class="step step-done"><span class="step-icon">âœ…</span>Form Done</div>
            <div class="step-connector">â€º</div>
            <div class="step step-pending"><span class="step-icon">â³</span>Pending</div>
            <div class="step-connector">â€º</div>
            <div class="step step-locked"><span class="step-icon">ğŸ”’</span>Hostel</div>
          </div>
          <p style="margin-top:12px;">Status: <span class="badge badge-pending">â³ Pending Approval</span></p>
          <p style="color:#888;font-size:13px;">Your form is under admin review. Features unlock after approval.</p>
        </div>

        <!-- APPROVED -->
        <div th:if="${profile != null and profile.status.name() == 'APPROVED'}">
          <div class="steps">
            <div class="step step-done"><span class="step-icon">âœ…</span>Registered</div>
            <div class="step-connector">â€º</div>
            <div class="step step-done"><span class="step-icon">âœ…</span>Form Done</div>
            <div class="step-connector">â€º</div>
            <div class="step step-done"><span class="step-icon">âœ…</span>Approved</div>
            <div class="step-connector">â€º</div>
            <div class="step step-done"><span class="step-icon">ğŸ </span>Hostel</div>
          </div>
          <p style="margin-top:12px;">Status: <span class="badge badge-approved">âœ… Approved</span></p>
          <p style="color:#555;font-size:13px;">Congratulations! All features are now unlocked.</p>
          <div class="btn-row">
            <a href="#tab-rent"  class="action-btn btn-green">ğŸ’° Rent Payment</a>
            <a href="#tab-query" class="action-btn btn-blue">ğŸ“© Query / Support</a>
          </div>
        </div>

        <!-- REJECTED -->
        <div th:if="${profile != null and profile.status.name() == 'REJECTED'}">
          <div class="steps">
            <div class="step step-done"><span class="step-icon">âœ…</span>Registered</div>
            <div class="step-connector">â€º</div>
            <div class="step step-done"><span class="step-icon">âœ…</span>Form Done</div>
            <div class="step-connector">â€º</div>
            <div class="step step-rejected"><span class="step-icon">âŒ</span>Rejected</div>
            <div class="step-connector">â€º</div>
            <div class="step step-locked"><span class="step-icon">ğŸ”’</span>Hostel</div>
          </div>
          <p style="margin-top:12px;">Status: <span class="badge badge-rejected">âŒ Rejected</span></p>
          <p style="color:#888;font-size:13px;">Please contact the hostel office for more information.</p>
        </div>

      </div>
    </div>

    <!-- ====== TAB 2: MY PROFILE ====== -->
    <div id="tab-profile" class="section-panel" th:if="${profile != null}">
      <div class="card">
        <h3>ğŸ‘¤ My Profile Details</h3>
        <div class="info-grid">
          <div class="item"><label>Mobile</label><span th:text="${profile.phoneNumber}"></span></div>
          <div class="item"><label>Address</label><span th:text="${profile.address}"></span></div>
          <div class="item"><label>College</label><span th:text="${profile.collegeName}"></span></div>
          <div class="item"><label>Course</label><span th:text="${profile.course}"></span></div>
          <div class="item"><label>Year</label><span th:text="${profile.yearOfStudy}"></span></div>
          <div class="item"><label>Parent Name</label><span th:text="${profile.parentName}"></span></div>
          <div class="item"><label>Parent Contact</label><span th:text="${profile.parentContact}"></span></div>
        </div>
      </div>
    </div>

    <!-- ====== TAB 3: RENT PAYMENT ====== -->
    <div id="tab-rent" class="section-panel">
      <div class="card">
        <h3>ğŸ’° Rent Payment</h3>
        <div th:if="${profile != null and profile.status.name() == 'APPROVED'}">
          <p style="color:#666;font-size:14px;">Rent payment details will be shown here.</p>
          <div class="btn-row">
            <a href="#" class="action-btn btn-green">ğŸ’³ Pay Rent Online</a>
          </div>
        </div>
        <div th:unless="${profile != null and profile.status.name() == 'APPROVED'}" class="locked-box">
          <div class="lock-icon">ğŸ”’</div>
          <p>Available only after admin approves your admission.</p>
        </div>
      </div>
    </div>

    <!-- ====== TAB 4: QUERY / SUPPORT ====== -->
    <div id="tab-query" class="section-panel">
      <div class="card">
        <h3>ğŸ“© Query / Support</h3>
        <div th:if="${profile != null and profile.status.name() == 'APPROVED'}">
          <p style="color:#666;font-size:14px;">Submit your queries or complaints to hostel admin.</p>
          <div class="btn-row">
            <a href="#" class="action-btn btn-blue">âœ‰ï¸ Send Query</a>
          </div>
        </div>
        <div th:unless="${profile != null and profile.status.name() == 'APPROVED'}" class="locked-box">
          <div class="lock-icon">ğŸ”’</div>
          <p>Available only after admin approves your admission.</p>
        </div>
      </div>
    </div>

  </div>
</main>
<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
