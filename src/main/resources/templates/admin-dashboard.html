
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Dashboard - Hostel Management</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        body {
            font-family: Arial, sans-serif; margin: 0; padding: 0;
            background: #f0f2f5;
            display: flex; flex-direction: column; min-height: 100vh;
        }
        main { flex: 1; }
        .wrapper { max-width: 1100px; margin: 30px auto; padding: 0 15px; }

        h2 { color: #2c3e50; }

        /* Section card */
        .section-card {
            background: white; border-radius: 10px; padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .section-card h3 {
            margin-top: 0; margin-bottom: 16px;
            font-size: 17px; color: #2c3e50;
            border-bottom: 2px solid #f0f2f5; padding-bottom: 10px;
        }

        /* Table */
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { background: #2c3e50; color: white; padding: 10px 12px; text-align: left; }
        td { padding: 9px 12px; border-bottom: 1px solid #eee; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: #fafafa; }

        /* Badges */
        .badge {
            display: inline-block; padding: 4px 10px;
            border-radius: 12px; font-size: 12px; font-weight: bold;
        }
        .badge-pending  { background: #fff3cd; color: #856404; }
        .badge-approved { background: #d4edda; color: #155724; }
        .badge-rejected { background: #f8d7da; color: #721c24; }
        .badge-paid     { background: #d4edda; color: #155724; }
        .badge-unpaid   { background: #f8d7da; color: #721c24; }

        /* Buttons */
        .btn { padding: 5px 12px; border: none; border-radius: 5px;
               cursor: pointer; color: white; font-size: 13px; }
        .btn-approve { background: #27ae60; }
        .btn-reject  { background: #e74c3c; }
        .btn-pay     { background: #f39c12; }
        .btn:hover   { opacity: 0.85; }

        /* Month filter form */
        .month-form { display: flex; gap: 10px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
        .month-form select, .month-form input {
            padding: 7px 10px; border-radius: 5px;
            border: 1px solid #ccc; font-size: 14px;
        }
        .month-form button {
            padding: 7px 16px; background: #3498db; color: white;
            border: none; border-radius: 5px; cursor: pointer; font-size: 14px;
        }

        .no-data { text-align: center; color: #aaa; padding: 20px; font-size: 15px; }
        .alert { padding: 12px; border-radius: 6px; margin-bottom: 16px; text-align: center; }
        .alert-success { background: #d4edda; color: #155724; }

        .btn-logout {
            display: inline-block; padding: 8px 18px; background: #e74c3c;
            color: white; text-decoration: none; border-radius: 6px; margin-top: 10px;
        }
    </style>
</head>
<body>

<div th:replace="fragments/header :: header"></div>

<main>
<div class="wrapper">

    <h2>‚öôÔ∏è Admin Dashboard</h2>

    <!-- Flash message -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

    <!-- ================================================
         SECTION 1: PENDING ADMISSIONS (Approve/Reject)
    ================================================ -->
    <div class="section-card">
        <h3>‚è≥ Pending Admissions</h3>
        <div th:if="${#lists.isEmpty(pendingProfiles)}" class="no-data">
            No pending admissions.
        </div>
        <table th:unless="${#lists.isEmpty(pendingProfiles)}">
            <thead>
                <tr>
                    <th>#</th><th>Name</th><th>Email</th>
                    <th>College</th><th>Course</th><th>Phone</th><th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="p, s : ${pendingProfiles}">
                    <td th:text="${s.count}"></td>
                    <td th:text="${p.user != null ? p.user.name  : '-'}"></td>
                    <td th:text="${p.user != null ? p.user.email : '-'}"></td>
                    <td th:text="${p.collegeName}"></td>
                    <td th:text="${p.course}"></td>
                    <td th:text="${p.phoneNumber}"></td>
                    <td>
                        <form th:action="@{/admin/approve/{id}(id=${p.id})}"
                              method="post" style="display:inline;">
                            <button type="submit" class="btn btn-approve">‚úÖ Approve</button>
                        </form>
                        <form th:action="@{/admin/reject/{id}(id=${p.id})}"
                              method="post" style="display:inline; margin-left:5px;">
                            <button type="submit" class="btn btn-reject">‚ùå Reject</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- ================================================
         SECTION 2: APPROVED / REJECTED QUICK VIEW
    ================================================ -->
    <div class="section-card">
        <h3>‚úÖ Approved Students &nbsp;|&nbsp; ‚ùå Rejected Students</h3>
        <table>
            <thead>
                <tr><th>Name</th><th>Email</th><th>College</th><th>Status</th></tr>
            </thead>
            <tbody>
                <tr th:each="p : ${approvedProfiles}">
                    <td th:text="${p.user != null ? p.user.name  : '-'}"></td>
                    <td th:text="${p.user != null ? p.user.email : '-'}"></td>
                    <td th:text="${p.collegeName}"></td>
                    <td><span class="badge badge-approved">‚úÖ APPROVED</span></td>
                </tr>
                <tr th:each="p : ${rejectedProfiles}">
                    <td th:text="${p.user != null ? p.user.name  : '-'}"></td>
                    <td th:text="${p.user != null ? p.user.email : '-'}"></td>
                    <td th:text="${p.collegeName}"></td>
                    <td><span class="badge badge-rejected">‚ùå REJECTED</span></td>
                </tr>
                <tr th:if="${#lists.isEmpty(approvedProfiles) and #lists.isEmpty(rejectedProfiles)}">
                    <td colspan="4" class="no-data">No approved or rejected profiles yet.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- ================================================
         SECTION 3: MONTH-WISE PAYMENT STATUS
    ================================================ -->
    <div class="section-card">
        <h3>üìÖ Month-wise Approved Students &amp; Rent Status</h3>

        <!-- Month + Year filter form (pure HTML, no JS) -->
        <form method="get" action="/admin/dashboard" class="month-form">
            <label>Month:</label>
            <select name="month">
                <option value="1"  th:selected="${selectedMonth == 1}">January</option>
                <option value="2"  th:selected="${selectedMonth == 2}">February</option>
                <option value="3"  th:selected="${selectedMonth == 3}">March</option>
                <option value="4"  th:selected="${selectedMonth == 4}">April</option>
                <option value="5"  th:selected="${selectedMonth == 5}">May</option>
                <option value="6"  th:selected="${selectedMonth == 6}">June</option>
                <option value="7"  th:selected="${selectedMonth == 7}">July</option>
                <option value="8"  th:selected="${selectedMonth == 8}">August</option>
                <option value="9"  th:selected="${selectedMonth == 9}">September</option>
                <option value="10" th:selected="${selectedMonth == 10}">October</option>
                <option value="11" th:selected="${selectedMonth == 11}">November</option>
                <option value="12" th:selected="${selectedMonth == 12}">December</option>
            </select>
            <label>Year:</label>
            <input type="number" name="year" th:value="${selectedYear}" min="2024" max="2030"/>
            <button type="submit">üîç Filter</button>
        </form>

        <div th:if="${#lists.isEmpty(monthlyProfiles)}" class="no-data">
            No approved students found for this month.
        </div>
        <table th:unless="${#lists.isEmpty(monthlyProfiles)}">
            <thead>
                <tr>
                    <th>#</th><th>Name</th><th>Email</th>
                    <th>College</th><th>Submitted On</th>
                    <th>Rent Status</th><th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="p, s : ${monthlyProfiles}">
                    <td th:text="${s.count}"></td>
                    <td th:text="${p.user != null ? p.user.name  : '-'}"></td>
                    <td th:text="${p.user != null ? p.user.email : '-'}"></td>
                    <td th:text="${p.collegeName}"></td>
                    <td th:text="${p.submittedAt}"></td>
                    <!-- GREEN = paid, RED = pending -->
                    <td>
                        <span th:if="${p.rentPaid}"
                              class="badge badge-paid">üíö Rent Paid</span>
                        <span th:unless="${p.rentPaid}"
                              class="badge badge-unpaid">üî¥ Rent Pending</span>
                    </td>
                    <td>
                        <!-- Mark rent paid button (only if not already paid) -->
                        <form th:unless="${p.rentPaid}"
                              th:action="@{/admin/rent-paid/{id}(id=${p.id})}"
                              method="post" style="display:inline;">
                            <button type="submit" class="btn btn-pay">üí∞ Mark Paid</button>
                        </form>
                        <span th:if="${p.rentPaid}" style="color:#27ae60; font-size:13px;">‚úî Done</span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- ================================================
         SECTION 4: QUERY / SUPPORT REPORTS
    ================================================ -->
    <div class="section-card">
        <h3>üì© Student Queries / Support Requests</h3>
        <div th:if="${#lists.isEmpty(queryProfiles)}" class="no-data">
            No queries submitted by students yet.
        </div>
        <table th:unless="${#lists.isEmpty(queryProfiles)}">
            <thead>
                <tr><th>#</th><th>Name</th><th>Email</th><th>Query / Message</th></tr>
            </thead>
            <tbody>
                <tr th:each="p, s : ${queryProfiles}">
                    <td th:text="${s.count}"></td>
                    <td th:text="${p.user != null ? p.user.name  : '-'}"></td>
                    <td th:text="${p.user != null ? p.user.email : '-'}"></td>
                    <td th:text="${p.queryText}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <a href="/logout" class="btn-logout">Logout</a>

</div>
</main>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
